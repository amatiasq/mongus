!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=7)}([function(e,t,s){"use strict";function i(){const e=new Map;return t.subscribe=function(t,s){const i=e.get(t)||new Set;i.size||e.set(t,i);return i.add(s),()=>i.delete(s)},t;function t(t,s){const i=e.get(t);return!!i&&(i.forEach(e=>e(s)),Boolean(i.size))}}function n(){const e=new Set;return t.subscribe=function(t){return e.add(t),()=>e.delete(t)},t;function t(t){return e.forEach(e=>e(t)),Boolean(e.size)}}s.r(t),s.d(t,"emitterWithChannels",(function(){return i})),s.d(t,"emitter",(function(){return n}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDistance=t.getCenterOf=t.getMagnitude=t.negate=t.minus=t.plus=t.multiply=t.serializeVector=void 0,t.serializeVector=function(e){return{x:Math.round(100*e.x)/100,y:Math.round(100*e.y)/100}},t.multiply=e=>t=>({x:t.x*e,y:t.y*e}),t.plus=e=>t=>({x:e.x+t.x,y:e.y+t.y}),t.minus=e=>t.plus(t.negate(e)),t.negate=t.multiply(-1),t.getMagnitude=function({x:e,y:t}){return Math.sqrt(e*e+t*t)},t.getCenterOf=function({width:e,height:t}){return{x:e/2,y:t/2}},t.getDistance=function(e,t){const s=e.x-t.x,i=e.y-t.y;return s*s+i*i}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decompressList=t.compressList=t.chain=void 0;t.chain=function(e,...t){return t.reduce((e,t)=>t(e),e)},t.compressList=function(e,t,s){if(t.length!==s.length)return s;const i=s.map((s,i)=>e(s,t[i])?0:s);return i.every(e=>0===e)?void 0:i},t.decompressList=function(e,t){return t?void 0===e?t:e.map((e,s)=>0===e?t[s]:e):e}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerMessageType=void 0,function(e){e.ERROR="ERROR",e.HANDSHAKE="HANDSHAKE",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.USER_CONNECTED="USER_CONNECTED",e.USER_DISCONNECTED="USER_DISCONNECTED",e[e.GAME_STEP=1]="GAME_STEP"}(t.ServerMessageType||(t.ServerMessageType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUser=void 0;const i=s(10);t.ClientUser=class{constructor(e,t=!1){this.isPlayer=t,i.deserializeUser(this,e)}get name(){return this.player.name}toJSON(){return i.serializeUser(this)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Orientation=void 0,function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(t.Orientation||(t.Orientation={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0;const i=/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?$/,n=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})?$/,r=/^rgb\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)$/,o=/^rgba\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)$/,a=255;class c{constructor(e,t,s,i=1){this.r=e,this.g=t,this.b=s,this.a=i}static fromArray([e,t,s,i]){return new c(e,t,s,null==i?1:i)}static fromHex(e){const t=function(e){const t=i.exec(e)||n.exec(e);if(!t)throw new Error("Invalid HEX color "+e);const s=t.slice(1);s[3]=s[3]||"FF";const r=s.map(e=>{const t=2===e.length?e:e+e;return parseInt(t,16)});return r[3]/=255,r}(e.trim());return this.fromArray(t)}static fromRgb(e){const t=function(e){const t=r.exec(e)||o.exec(e);if(!t)throw new Error("Invalid RGB color "+e);const[s,i,n,a]=t.slice(1);return[parseFloat(s),parseFloat(i),parseFloat(n),null==a?1:parseFloat(a)]}(e.trim());return this.fromArray(t)}static fromImageData(e,t){return new c(e[t],e[t+1],e[t+2],e[t+3])}get hex(){return function(e){const t=e.toArray();1===t[3]?t.length--:t[3]=Math.round(t[3]*a);return"#"+t.map(e=>e.toString(16)).join("")}(this)}get rgb(){return`rgba(${this.toArray().join(", ")})`}get brightness(){return(.299*(e=this).r+.587*e.g+.114*e.b)/256;var e}get isLight(){return this.brightness>.5}get isDark(){return this.brightness<=.5}isLigherThan(e){return this.brightness>e.brightness}isDarkerThan(e){return this.brightness<e.brightness}isEqual(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}shade(e){return new c(...this.toArray().map(t=>t*(1-e)))}setToImageData(e,t,s=!1){e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,s||(e[t+3]=255*this.a)}toArray(){const{r:e,g:t,b:s,a:i}=this;return[e,t,s,i]}toString(){return this.rgb}toJSON(){return this.rgb}}t.Color=c},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(8),n=s(9),r=s(3),o=s(4),a=s(13),c=s(14),h=s(15),u=s(16),d=s(18);const l="https://amatiasq.github.io"===location.origin?"wss://amongus.amatiasq.com":"ws://localhost:17965",y=new c.GameState,p=new d.Renderer(document.querySelector("canvas")),g=new a.GameEngine,f=new i.ResilientSocket(l);p.fillPage(),u.watchKeyboard(e=>g.send(n.ClientMessageType.USER_ACTIONS,{actions:Array.from(e)})),g.pipeline(a.Hook.SEND_MESSAGE).then(h.compress).then(h.serialize),g.pipeline(a.Hook.RECEIVE_MESSAGE).then(h.deserialize).then(h.decompress),f.onMessage(e=>g.trigger(a.Hook.RECEIVE_MESSAGE,e)),g.register(a.Hook.SEND_MESSAGE,e=>f.send(e)),f.onOpen(()=>u.getUserName().then(async e=>(await p.whenReady,e)).then(e=>{g.send(n.ClientMessageType.LOGIN,{uuid:y.uuid,username:e})})),f.onReconnect(()=>g.send(n.ClientMessageType.RECONNECT,{uuid:y.uuid,username:y.me.name})),g.onMessage(r.ServerMessageType.LOGIN_SUCCESS,e=>{y.setUsers(e.users),y.setObstacles(e.obstacles)}),g.onMessage(r.ServerMessageType.USER_CONNECTED,e=>y.addUser(new o.ClientUser(e.user))),g.onMessage(r.ServerMessageType.USER_DISCONNECTED,e=>y.removeUser(e.uuid)),g.onMessage(r.ServerMessageType.GAME_STEP,({users:e,entities:t})=>{if(y.setUsers(e),y.setEntities(t),!y.me)throw new Error("Can't find player in user list. UUID-"+y.uuid);p.centerCameraAt(y.me.player.position),p.render(y)}),window.onbeforeunload=()=>g.send(n.ClientMessageType.LOGOUT)},function(e,t,s){"use strict";s.r(t),s.d(t,"ResilientSocket",(function(){return n}));var i=s(0);class n{constructor(e,{reconnectionDelay:t=100,maxReconnectAttempts:s=14}={}){this.uri=e,this.reconnectionDelay=100,this.reconnectAttempts=0,this.disconnectedAt=new Date,this.isReconnecting=!1,this.isFirstConnection=!0,this.messageQueue=[],this.emitOpen=Object(i.emitter)(),this.onOpen=this.emitOpen.subscribe,this.emitError=Object(i.emitter)(),this.onError=this.emitError.subscribe,this.emitClose=Object(i.emitter)(),this.onClose=this.emitClose.subscribe,this.emitMessage=Object(i.emitter)(),this.onMessage=this.emitMessage.subscribe,this.emitReconnect=Object(i.emitter)(),this.onReconnect=this.emitReconnect.subscribe,this.connectionOpen=this.connectionOpen.bind(this),this.processMessage=this.processMessage.bind(this),this.connectionLost=this.connectionLost.bind(this),this.ws=this.init(),this.RECONNECTION_DELAY=t,this.MAX_RECONNECT_ATTEMPTS=s}get isConnected(){return!this.isFirstConnection&&!this.isReconnecting}send(e){this.isConnected?this.ws.send(e):this.messageQueue.push(e)}init(){const e=new WebSocket(this.uri);return e.addEventListener("open",this.connectionOpen),e.addEventListener("message",this.processMessage),e.addEventListener("error",this.connectionLost),e.addEventListener("close",this.connectionLost),e}unbind(){this.ws.removeEventListener("open",this.connectionOpen),this.ws.removeEventListener("message",this.processMessage),this.ws.removeEventListener("error",this.connectionLost),this.ws.removeEventListener("close",this.connectionLost)}processMessage(e){this.emitMessage(e)}connectionOpen(e){this.resetReconnectionCounters(),this.isFirstConnection?(this.isFirstConnection=!1,this.emitOpen(e)):this.emitReconnect(Object.assign(e,{disconnectedTime:this.disconnectedAt})),this.processMessageQueue()}connectionLost(e){this.isReconnecting||(this.reconnectAttempts>this.MAX_RECONNECT_ATTEMPTS&&this.reconnectionFailed(e),0===this.reconnectAttempts&&(this.isReconnecting=!0,this.disconnectedAt=new Date),this.unbind(),this.scheduleReconnection())}resetReconnectionCounters(){this.reconnectionDelay=this.RECONNECTION_DELAY,this.reconnectAttempts=0,this.isReconnecting=!1}processMessageQueue(){for(const e in this.messageQueue)this.ws.send(e);this.messageQueue.length=0}reconnectionFailed(e){return this.emitError(e),console.error(`Websocket aborted after ${this.reconnectAttempts} attempts`)}scheduleReconnection(){const e=`Socket closed. Waiting ${this.reconnectionDelay/1e3}s`,t="Reconnecting...",s=this.reconnectAttempts<1e3;console.debug(`${e} ${s?t:""}`),setTimeout(()=>{s||console.debug(t),this.reconnectionDelay*=2,this.reconnectAttempts++,this.ws=this.init()},this.reconnectionDelay)}close(){this.unbind(),this.ws.onclose=this.emitClose,this.ws.close()}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientMessageType=void 0,function(e){e.ERROR="ERROR",e.LOGIN="LOGIN",e.LOGOUT="LOGOUT",e.RECONNECT="RECONNECT",e[e.USER_ACTIONS=1]="USER_ACTIONS",e.SET_OBSTACLES="SET_OBSTACLES"}(t.ClientMessageType||(t.ClientMessageType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeUser=t.serializeUser=void 0;const i=s(11);t.serializeUser=function(e){return{id:e.id,player:i.serializePlayer(e.player)}},t.deserializeUser=function(e,t){return e.id=t.id,e.player=i.deserializePlayer(e.player||i.createPlayer(),t.player),e}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializePlayer=t.serializePlayer=t.createPlayer=void 0;const i=s(12);t.createPlayer=function(){return{...i.createEntity(),type:i.EntityType.Player,isDead:!1}},t.serializePlayer=function(e){return{...i.serializeEntity(e),type:i.EntityType.Player,name:e.name,isDead:e.isDead,speed:e.speed}},t.deserializePlayer=function(e,t){return i.deserializeEntity(e,t),e.type=i.EntityType.Player,e.name=t.name,e.isDead=t.isDead,e.speed=t.speed,e}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeEntity=t.serializeEntity=t.createEntity=t.EntityType=void 0;const i=s(5),n=s(1);var r;!function(e){e[e.Unknown=0]="Unknown",e[e.Player=1]="Player",e[e.DeadBody=2]="DeadBody"}(r=t.EntityType||(t.EntityType={})),t.createEntity=function(){return{type:r.Unknown,color:"#FFFFFF",position:{x:0,y:0},orientation:i.Orientation.Left}},t.serializeEntity=function({type:e,color:t,position:s,orientation:i}){return{type:e,color:t,position:n.serializeVector(s),orientation:i}},t.deserializeEntity=function(e,{type:t,color:s,position:i,orientation:n}){return e.type=t,e.color=s,e.position=i,e.orientation=n,e}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameEngine=t.Hook=void 0;const i=s(0);var n;!function(e){e[e.RECEIVE_MESSAGE=0]="RECEIVE_MESSAGE",e[e.SEND_MESSAGE=1]="SEND_MESSAGE",e[e.MESSAGE_SENT=2]="MESSAGE_SENT"}(n=t.Hook||(t.Hook={}));t.GameEngine=class{constructor(){this.listeners=i.emitterWithChannels(),this.channels=new Map,this.pipes=new Map,this.send=(e,t)=>this.trigger(n.SEND_MESSAGE,{type:e,data:t}),this.onMessage=(e,t)=>this.listeners.subscribe(e,t),this.register(n.RECEIVE_MESSAGE,({type:e,data:t})=>this.listeners(e,t))}trigger(e,t){const s=this.pipes.get(e),i=this.channels.get(e);if(!s&&!i)return;const n=s?s.reduce((e,t)=>t(e),t):t;i&&i.forEach(e=>e(n))}register(e,t){if(!this.channels.has(e))return void this.channels.set(e,[t]);this.channels.get(e).push(t)}pipeline(e){return this.pipes.has(e)||this.pipes.set(e,[]),this.createPipe(e)}createPipe(e){return{then:t=>(this.pipes.get(e).push(t),this.createPipe(e))}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameState=void 0;const i=s(4);t.GameState=class{constructor(){this.uuid=`${Math.random()}${Date.now()}`,this.users=[],this.entities=[],this.obstacles=[]}get players(){return this.users.map(e=>e.player)}setObstacles(e){this.obstacles=e}setEntities(e){this.entities=e}setUsers(e){this.users=this.getUsersFromServer(e,this.uuid),this.me=this.users.find(e=>e.isPlayer)}addUser(e){this.users.push(e),this.onUserListChanged()}removeUser(e){const t=this.users.findIndex(t=>t.id===e);-1!==t&&(this.users.splice(t,1),this.onUserListChanged())}getUsersFromServer(e,t){return e.map(e=>new i.ClientUser(e,e.id===t))}onUserListChanged(){console.log("users",this.users)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decompress=t.compress=t.deserialize=t.serialize=void 0;const i=s(3),n=s(2);let r,o;t.serialize=function(e){return JSON.stringify(e)},t.deserialize=function(e){try{return JSON.parse(e.data)}catch(t){throw new Error(`Invalid JSON (${t.message}): "${e.data}"`)}},t.compress=function(e){return e},t.decompress=function(e){if(e.type!=i.ServerMessageType.GAME_STEP)return e;const{data:t}=e;return r=n.decompressList(t.users,r),o=n.decompressList(t.entities,o),{...e,data:{...e.data,users:r,entities:o}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUserName=t.watchKeyboard=void 0;const i=s(23),n=s(17),r=new i.KeyboardActions;r.setDirections(n.Action.UP,n.Action.DOWN,n.Action.LEFT,n.Action.RIGHT),r.setKeyMap(i.KeyCode.KeyK,n.Action.KILL),r.setKeyMap(i.KeyCode.KeyR,n.Action.RESURRECT),r.setKeyMap(i.KeyCode.KeyM,n.Action.COMMIT_SUICIDE),t.watchKeyboard=function(e){r.onChange(t=>e(t))},t.getUserName=async function(){const e="amongus:username",t=sessionStorage.getItem(e);if(t)return Promise.resolve(t);const s=document.querySelector("#login"),i=s.querySelector("form"),n=null==i?void 0:i.querySelector("input[type=text]");return s.showModal(),new Promise((t,s)=>{i.addEventListener("submit",s=>{const i=n.value.trim();sessionStorage.setItem(e,i),t(i)})})}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Action=void 0,function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT",e[e.KILL=4]="KILL",e[e.RESURRECT=5]="RESURRECT",e[e.COMMIT_SUICIDE=6]="COMMIT_SUICIDE"}(t.Action||(t.Action={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;const i=s(5),n=s(2),r=s(1),o=s(19),a=s(20);t.Renderer=class{constructor(e){this.canvas=e,this.context=this.canvas.getContext("2d"),this.sprites=new a.SpriteManager({player:"assets/sprites/player.png",phantom:"assets/sprites/phantom.png",body:"assets/sprites/body.png",background:"assets/map/Cafeteria-sharedassets0.assets-210.png"}),this.camera={x:0,y:0},this.renderObstacle=this.renderObstacle.bind(this),this.renderDeadBody=this.renderDeadBody.bind(this),this.renderPlayer=this.renderPlayer.bind(this)}get whenReady(){return this.sprites.whenLoaded}get width(){return this.canvas.width}get height(){return this.canvas.height}get center(){return r.getCenterOf(this)}fullscreen(){const e=()=>{this.canvas.parentElement.requestFullscreen(),document.removeEventListener("keydown",e),document.removeEventListener("mousedown",e)};document.addEventListener("keydown",e),document.addEventListener("mousedown",e)}fillPage(){const e=()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight};e(),window.addEventListener("resize",e)}centerCameraAt({x:e,y:t}){this.camera={x:e,y:t}}render({players:e,entities:t,obstacles:s}){const i=n.chain(this.center,r.minus(this.camera));this.context.clearRect(0,0,this.width,this.height),this.context.save(),this.context.translate(i.x,i.y),this.renderBackground(),s.forEach(this.renderObstacle),t.forEach(this.renderDeadBody),e.forEach(this.renderPlayer),this.context.restore(),this.renderVisibilityRange()}renderBackground(){this.sprites.get("background").renderTo(this.context)}renderObstacle({x:e,y:t,width:s,height:i}){this.context.strokeStyle="red",this.context.strokeRect(e,t,s,i)}renderDeadBody(e){const t=this.sprites.getColored("body",o.getColorPatch(e.color)).at(e.position);e.orientation===i.Orientation.Right&&t.flip(),t.renderTo(this.context)}renderPlayer(e){const t=e.isDead?"phantom":"player",s=this.sprites.getColored(t,o.getColorPatch(e.color)).at(e.position);!function(e,t,s,i,{x:n,y:r}){const o=i.split("").join(String.fromCharCode(8202));e.save(),e.font=t,e.textAlign="center",e.strokeStyle="black",e.lineWidth=5,e.miterLimit=2,e.strokeText(o,n,r),e.fillStyle=s,e.fillText(o,n,r),e.restore()}(this.context,"18px Arial",e.color,e.name,{x:e.position.x,y:e.position.y-15+s.offset.y}),e.orientation===i.Orientation.Left&&s.flip(),this.context.save(),e.isDead&&(this.context.globalAlpha=.8),s.renderTo(this.context),this.context.globalAlpha=1,this.context.restore()}renderVisibilityRange(){const{x:e,y:t}=this.center,s=this.context.createRadialGradient(e,t,100,e,t,400);s.addColorStop(0,"transparent"),s.addColorStop(1,"black"),this.context.fillStyle=s,this.context.fillRect(0,0,this.width,this.height)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getColorPatch=void 0;const i=s(6),n={};function r(e){return c(e.r,e.g,e.b)}function o(e){return c(e.b,e.r,e.g)}function a(e){return e.r===e.b&&e.r>e.g}function c(e,t,s){return e>10&&e>t&&e>s}t.getColorPatch=function(e){if(n[e])return n[e];const t=i.Color.fromHex(e),s=t.shade(.5),c=new Map;return c.set(r,t),c.set(o,s),c.set(a,s),n[e]=c,c}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteManager=void 0;const i=s(21),n=s(6),r=s(22);t.SpriteManager=class{constructor(e){this.cache={},this.images={},this.isLoaded=!1;const t=i.getKeys(e).map(t=>{return(s=e[t],new Promise((e,t)=>{const i=new Image;i.onload=()=>e(i),i.onerror=t,i.src=s})).then(e=>this.images[t]=e);var s});this.whenLoaded=Promise.all(t).then(e=>{this.isLoaded=!0})}get(e){return new r.Sprite(this.images[e])}getColored(e,t){let s=this.cache[e];if(s||(s=this.cache[e]=new Map),s.has(t))return new r.Sprite(s.get(t));const i=this.paint(this.images[e],t);return s.set(t,i),new r.Sprite(i)}paint(e,t){const s=document.createElement("canvas"),i=s.getContext("2d"),{width:r,height:o}=e;s.width=r,s.height=o,i.drawImage(e,0,0);const a=i.getImageData(0,0,r,o),{data:c}=a,h=[...t.entries()],u=h.length;for(let e=0,t=c.length;e<t;e+=4){const t=n.Color.fromImageData(c,e);for(let s=0;s<u;s++){const i=h[s];if(i[0](t)){i[1].setToImageData(c,e,!0);break}}}return i.putImageData(a,0,0),s}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKeys=void 0,t.getKeys=Object.keys},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite=void 0;const i=s(2),n=s(1);t.Sprite=class{constructor(e){this.source=e,this.offset=i.chain(n.getCenterOf(this.source),n.negate),this.position=null,this.isFlipped=!1}get width(){return this.source.width}get height(){return this.source.height}flip(){return this.isFlipped=!this.isFlipped,this}at(e){return this.position=e,this}renderTo(e){e.save(),this.position&&e.translate(this.position.x,this.position.y),this.isFlipped&&e.scale(-1,1),e.drawImage(this.source,this.offset.x,this.offset.y),e.restore()}}},function(e,t,s){"use strict";function i(){const e=new Map;return t.subscribe=function(t,s){const i=e.get(t)||new Set;s.length||e.set(t,i);return i.add(s),()=>i.delete(s)},t;function t(t,s){const i=e.get(t);i&&i.forEach(e=>e(s))}}function n(){const e=new Set;return t.subscribe=function(t){return e.add(t),()=>e.delete(t)},t;function t(t){e.forEach(e=>e(t))}}s.r(t),s.d(t,"KeyboardActions",(function(){return a})),s.d(t,"KeyboardController",(function(){return r})),s.d(t,"KeyCode",(function(){return o}));class r{constructor(){this.pressed=new Set,this.codeToKey=new Map,this.emitKeyCodeDown=i(),this.emitKeyCodeUp=i(),this.emitKeyDown=n(),this.emitKeyUp=n(),this.onKeyCodeDown=this.emitKeyCodeDown.subscribe,this.onKeyCodeUp=this.emitKeyCodeUp.subscribe,this.onKeyDown=this.emitKeyDown.subscribe,this.onKeyUp=this.emitKeyUp.subscribe,this.isPaused=!1,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}pause(){this.isPaused=!0}resume(){this.isPaused=!1}isPressed(e){return this.pressed.has(e)}getUserKey(e){return this.codeToKey.has(e)?this.codeToKey.get(e):null}dispose(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}handleKeyDown(e){this.onEvent(e),this.isPressed(e.code)||(this.pressed.add(e.code),this.isPaused||(this.emitKeyDown(e),this.emitKeyCodeDown(e.code,e)))}handleKeyUp(e){this.onEvent(e),this.isPressed(e.code)&&(this.pressed.delete(e.code),this.isPaused||(this.emitKeyUp(e),this.emitKeyCodeUp(e.code,e)))}onEvent(e){this.codeToKey.set(e.code,e.key)}}var o;!function(e){e.AltLeft="AltLeft",e.AltRight="AltRight",e.Backslash="Backslash",e.Backspace="Backspace",e.CapsLock="CapsLock",e.ControlLeft="ControlLeft",e.Enter="Enter",e.Escape="Escape",e.MetaLeft="MetaLeft",e.MetaRight="MetaRight",e.ShiftLeft="ShiftLeft",e.ShiftRight="ShiftRight",e.Tab="Tab",e.ArrowDown="ArrowDown",e.ArrowLeft="ArrowLeft",e.ArrowRight="ArrowRight",e.ArrowUp="ArrowUp",e.Backquote="Backquote",e.BracketLeft="BracketLeft",e.BracketRight="BracketRight",e.Comma="Comma",e.Equal="Equal",e.IntlBackslash="IntlBackslash",e.Minus="Minus",e.Period="Period",e.Quote="Quote",e.Semicolon="Semicolon",e.Slash="Slash",e.Space="Space",e.F1="F1",e.F2="F2",e.F3="F3",e.F4="F4",e.F5="F5",e.F6="F6",e.F7="F7",e.F8="F8",e.Digit0="Digit0",e.Digit1="Digit1",e.Digit2="Digit2",e.Digit3="Digit3",e.Digit4="Digit4",e.Digit5="Digit5",e.Digit6="Digit6",e.Digit7="Digit7",e.Digit8="Digit8",e.Digit9="Digit9",e.KeyA="KeyA",e.KeyB="KeyB",e.KeyC="KeyC",e.KeyD="KeyD",e.KeyE="KeyE",e.KeyF="KeyF",e.KeyG="KeyG",e.KeyH="KeyH",e.KeyI="KeyI",e.KeyJ="KeyJ",e.KeyK="KeyK",e.KeyL="KeyL",e.KeyM="KeyM",e.KeyN="KeyN",e.KeyO="KeyO",e.KeyP="KeyP",e.KeyQ="KeyQ",e.KeyR="KeyR",e.KeyS="KeyS",e.KeyT="KeyT",e.KeyU="KeyU",e.KeyV="KeyV",e.KeyW="KeyW",e.KeyX="KeyX",e.KeyY="KeyY",e.KeyZ="KeyZ"}(o||(o={}));class a{constructor(){this.keyboard=new r,this.keymap={},this.actions=new Set,this.emitChange=n(),this.emitActivate=i(),this.emitDeactivate=i(),this.onChange=this.emitChange.subscribe,this.onActivate=this.emitActivate.subscribe,this.onDeactivate=this.emitDeactivate.subscribe,this.handleKeyDown=this.handle(e=>{this.actions.has(e)||(this.actions.add(e),this.emitActivate(e),this.emitChange(Array.from(this.actions)))}),this.handleKeyUp=this.handle(e=>{this.actions.has(e)&&(this.actions.delete(e),this.emitDeactivate(e),this.emitChange(Array.from(this.actions)))}),this.subscriptions=[this.keyboard.onKeyDown(this.handleKeyDown),this.keyboard.onKeyUp(this.handleKeyUp)]}get isPaused(){return this.keyboard.isPaused}pause(){this.keyboard.pause()}resume(){this.keyboard.resume()}getUserKey(e){this.keyboard.getUserKey(e)}setKeyMap(e,t){this.keymap[e]=t}isActive(e){return this.actions.has(e)}dispose(){this.subscriptions.forEach(e=>e()),this.keyboard.dispose()}setDirections(e,t,s,i){this.setArrows(e,t,s,i),this.setWSAD(e,t,s,i)}setArrows(e,t,s,i){this.keymap[o.ArrowUp]=e,this.keymap[o.ArrowDown]=t,this.keymap[o.ArrowLeft]=s,this.keymap[o.ArrowRight]=i}setWSAD(e,t,s,i){this.keymap[o.KeyW]=e,this.keymap[o.KeyS]=t,this.keymap[o.KeyA]=s,this.keymap[o.KeyD]=i}getActionFor(e){return o[e]||console.log("Missing key code: "+e),this.keymap[e]}handle(e){return t=>{const s=this.getActionFor(t.code);null!=s&&e(s)}}}}]);
//# sourceMappingURL=main.js.map