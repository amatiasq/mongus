{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Color.ts","webpack:///./src/index.ts","webpack:///../shared/communication/ClientMessage.ts","webpack:///../shared/communication/ServerMessage.ts","webpack:///./src/canvas.ts","webpack:///./src/PlayerSprite.ts","webpack:///./src/Socket.ts","webpack:///./src/User.ts","webpack:///../shared/SerializedUser.ts","webpack:///./src/interactions.ts","webpack:///../shared/Action.ts","webpack:///./node_modules/@amatiasq/keyboard/node_modules/@amatiasq/emitter/emitterWithChannels.ts","webpack:///./node_modules/@amatiasq/keyboard/node_modules/@amatiasq/emitter/emitter.ts","webpack:///./node_modules/@amatiasq/keyboard/KeyboardController.ts","webpack:///./node_modules/@amatiasq/keyboard/KeyCode.ts","webpack:///./node_modules/@amatiasq/keyboard/KeyboardActions.ts","webpack:///./node_modules/@amatiasq/emitter/emitter.ts","webpack:///./node_modules/@amatiasq/json-socket/JsonSocket.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","HEX_REGEX","SHORT_HEX_REGEX","RGB_REGEX","RGBA_REGEX","MAX_HEX","Color","g","b","a","array","match","exec","Error","hexValues","slice","map","chunk","hex","length","parseInt","parseHex","trim","this","fromArray","parseFloat","parseRgb","data","color","toArray","Math","round","x","toString","join","generateHex","brightness","isPredominant","factor","skipAlpha","rgb","socket","Socket","uuid","random","Date","now","users","entities","onUserListChanged","console","log","watchKeyboard","actions","send","type","ClientMessageType","USER_ACTIONS","Array","from","onOpen","LOGIN","onReconnect","RECONNECT","onMessageType","ServerMessageType","LOGIN_SUCCESS","User","id","USER_CONNECTED","push","user","USER_DISCONNECTED","index","findIndex","splice","GAME_STEP","render","window","onbeforeunload","LOGOUT","canvas","document","querySelector","context","getContext","player","PlayerSprite","phantom","body","fullscreen","width","innerWidth","height","innerHeight","onresize","clearRect","forEach","entity","sprite","getColor","fromHex","drawImage","position","y","fillStyle","textAlign","fillText","isDead","globalAlpha","src","template","Image","colors","Map","isReady","onload","hash","has","result","paintTemplate","set","dark","shade","createElement","image","getImageData","len","pixel","fromImageData","isReddish","setToImageData","isBlueish","putImageData","JsonSocket","uri","super","listeners","onMessage","e","processMessagePotato","listener","message","debug","isPlayer","serializeUser","keyboard","KeyboardActions","setDirections","Action","UP","DOWN","LEFT","RIGHT","setKeyMap","KeyCode","KeyK","KILL","notify","onChange","emitterWithChannels","channels","emit","subscribe","channel","Set","add","delete","emitter","pressed","codeToKey","emitKeyCodeDown","emitKeyCodeUp","emitKeyDown","emitKeyUp","onKeyCodeDown","onKeyCodeUp","onKeyDown","onKeyUp","isPaused","handleKeyDown","handleKeyUp","addEventListener","code","removeEventListener","event","onEvent","isPressed","keymap","emitChange","emitActivate","emitDeactivate","onActivate","onDeactivate","handle","action","subscriptions","pause","resume","getUserKey","dispose","up","down","left","right","setArrows","setWSAD","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyW","KeyS","KeyA","KeyD","operation","getActionFor","RECONNECTION_DELAY","MAX_RECONNECT_ATTEMPTS","reconnectionDelay","reconnectAttempts","disconnectedAt","isReconnecting","isFirstConnection","ws","init","WebSocket","onopen","connectionOpen","onmessage","processMessage","onerror","connectionLost","onclose","JSON","stringify","parse","error","reconnecting","singleLine","setTimeout","close"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","const HEX_REGEX = /^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?$/;\nconst SHORT_HEX_REGEX = /^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})?$/;\nconst RGB_REGEX = /^rgb\\s*\\(\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*\\)$/;\nconst RGBA_REGEX = /^rgba\\s*\\(\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*\\)$/;\n\nconst ALPHA = 3;\nconst DEFAULT_ALPHA = 1;\nconst HEXADECIMAL = 16;\nconst MAX_HEX = 255;\n\nexport class Color {\n  static fromArray([r, g, b, a]: [number, number, number] | ColorArray) {\n    return new Color(r, g, b, a == null ? DEFAULT_ALPHA : a);\n  }\n\n  static fromHex(value: string) {\n    const array = parseHex(value.trim());\n    return this.fromArray(array);\n  }\n\n  static fromRgb(value: string) {\n    const array = parseRgb(value.trim());\n    return this.fromArray(array);\n  }\n\n  static fromImageData(data: Uint8ClampedArray, i: number) {\n    return new Color(data[i], data[i + 1], data[i + 2], data[i + 3]);\n  }\n\n  get hex() {\n    return generateHex(this);\n  }\n\n  get rgb() {\n    return `rgba(${this.toArray().join(', ')})`;\n  }\n\n  get brightness() {\n    return calculateBrightness(this);\n  }\n\n  get isLight() {\n    return this.brightness > 0.5;\n  }\n\n  get isDark() {\n    return this.brightness <= 0.5;\n  }\n\n  get isReddish() {\n    return isPredominant(this.r, this.g, this.b);\n  }\n\n  get isBlueish() {\n    return isPredominant(this.b, this.r, this.g);\n  }\n\n  get isGreenish() {\n    return isPredominant(this.g, this.r, this.b);\n  }\n\n  constructor(\n    public readonly r: number,\n    public readonly g: number,\n    public readonly b: number,\n    public readonly a = DEFAULT_ALPHA,\n  ) {}\n\n  isLigherThan(color: Color) {\n    return this.brightness > color.brightness;\n  }\n\n  isDarkerThan(color: Color) {\n    return this.brightness < color.brightness;\n  }\n\n  isEqual(color: Color) {\n    return (\n      this.r === color.r &&\n      this.g === color.g &&\n      this.b === color.b &&\n      this.a === color.a\n    );\n  }\n\n  shade(factor: number) {\n    return new Color(\n      ...(this.toArray().map(x => x * (1 - factor)) as ColorArray),\n    );\n  }\n\n  setToImageData(data: Uint8ClampedArray, i: number, skipAlpha = false) {\n    data[i] = this.r;\n    data[i + 1] = this.g;\n    data[i + 2] = this.b;\n\n    if (!skipAlpha) {\n      data[i + 3] = this.a * 255;\n    }\n  }\n\n  toArray(): ColorArray {\n    const { r, g, b, a } = this;\n    return [r, g, b, a];\n  }\n\n  toString() {\n    return this.rgb;\n  }\n}\n\ntype ColorArray = [number, number, number, number];\n\nfunction calculateBrightness(color: Color) {\n  return (color.r * 0.299 + color.g * 0.587 + color.b * 0.114) / 256;\n}\n\nfunction parseHex(value: string): ColorArray {\n  const match = HEX_REGEX.exec(value) || SHORT_HEX_REGEX.exec(value);\n\n  if (!match) {\n    throw new Error('Invalid HEX color ' + value);\n  }\n\n  const hexValues = match.slice(1) as [string, string, string, string];\n  hexValues[ALPHA] = hexValues[ALPHA] || 'FF';\n\n  const array = hexValues.map(chunk => {\n    const hex = chunk.length === 2 ? chunk : chunk + chunk;\n    return parseInt(hex, HEXADECIMAL);\n  }) as ColorArray;\n\n  array[ALPHA] /= MAX_HEX;\n  return array;\n}\n\nfunction parseRgb(value: string): ColorArray {\n  const match = RGB_REGEX.exec(value) || RGBA_REGEX.exec(value);\n\n  if (!match) {\n    throw new Error('Invalid RGB color ' + value);\n  }\n\n  const [r, g, b, a] = match.slice(1) as [string, string, string, string];\n\n  return [\n    parseFloat(r),\n    parseFloat(g),\n    parseFloat(b),\n    a == null ? DEFAULT_ALPHA : parseFloat(a),\n  ];\n}\n\nfunction generateHex(color: Color) {\n  const array = color.toArray();\n\n  // Remove alpha if it's 1\n  if (array[ALPHA] === 1) {\n    array.length--;\n  } else {\n    array[ALPHA] = Math.round(array[ALPHA] * MAX_HEX);\n  }\n\n  const hex = array.map(x => x.toString(HEXADECIMAL));\n  return '#' + hex.join('');\n}\n\nfunction isPredominant(x: number, a: number, b: number) {\n  return x > 10 && x > a && x > b;\n}\n","import { DeadBody } from './../../shared/DeadBody';\nimport { ClientMessageType } from '../../shared/communication/ClientMessage';\nimport { ServerMessageType } from '../../shared/communication/ServerMessage';\nimport { UserId } from '../../shared/types';\nimport { render } from './canvas';\nimport { Socket } from './Socket';\nimport { User } from './User';\nimport { watchKeyboard } from './interactions';\n\n// const socket = new Socket('ws://localhost:17965');\nconst socket = new Socket('wss://amongus.amatiasq.com');\nconst uuid = `${Math.random()}${Date.now()}${Math.random()}©AMONGUS®` as UserId;\nlet users: User[] = [];\nlet entities: DeadBody[] = [];\n\nwatchKeyboard(actions =>\n  socket.send({\n    type: ClientMessageType.USER_ACTIONS,\n    actions: Array.from(actions),\n  }),\n);\n\n// requestAnimationFrame(function self() {\n//   render(users, entities);\n//   requestAnimationFrame(self);\n// });\n\nsocket.onOpen(() =>\n  socket.send({\n    type: ClientMessageType.LOGIN,\n    uuid,\n  }),\n);\n\nsocket.onReconnect(() =>\n  socket.send({\n    type: ClientMessageType.RECONNECT,\n    uuid,\n  }),\n);\n\nsocket.onMessageType(ServerMessageType.LOGIN_SUCCESS, data => {\n  users = data.users.map(x => new User(x, x.id === uuid));\n  onUserListChanged();\n});\n\nsocket.onMessageType(ServerMessageType.USER_CONNECTED, data => {\n  users.push(new User(data.user));\n  onUserListChanged();\n});\n\nsocket.onMessageType(ServerMessageType.USER_DISCONNECTED, data => {\n  const index = users.findIndex(x => x.id === data.uuid);\n  if (index !== -1) {\n    users.splice(index, 1);\n    onUserListChanged();\n  }\n});\n\nsocket.onMessageType(ServerMessageType.GAME_STEP, data => {\n  users = data.users.map(x => new User(x, x.id === uuid));\n  entities = data.entities;\n  render(users, entities);\n});\n\nwindow.onbeforeunload = () => {\n  socket.send({ type: ClientMessageType.LOGOUT });\n};\n\nfunction onUserListChanged() {\n  console.log('users', users);\n}\n","import { RoomMessage } from './RoomMessage';\nimport { UserId, UserName } from '../types';\nimport { ClientToClientMessage } from './ClientToClientMessage';\nimport { Action } from '../Action';\n\nexport enum ClientMessageType {\n  ERROR = 'ERROR',\n  LOGIN = 'LOGIN',\n  LOGOUT = 'LOGOUT',\n  RECONNECT = 'RECONNECT',\n  USER_ACTIONS = 1,\n}\n\ninterface ClientMessage__ERROR {\n  type: ClientMessageType.ERROR;\n  message: string;\n}\n\ninterface ClientMessage__LOGIN {\n  type: ClientMessageType.LOGIN;\n  uuid: UserId;\n}\n\ninterface ClientMessage__RECONNECT {\n  type: ClientMessageType.RECONNECT;\n  uuid: UserId;\n}\n\ninterface ClientMessage__LOGOUT {\n  type: ClientMessageType.LOGOUT;\n}\n\ninterface ClientMessage__USER_ACTIONS {\n  type: ClientMessageType.USER_ACTIONS;\n  actions: Action[];\n}\n\n// interface ClientMessage__SEND_TO_ROOM {\n//   type: ClientMessageType.SEND_TO_ROOM;\n//   message: RoomMessage;\n// }\n\n// interface ClientMessage__SEND_TO_USER {\n//   type: ClientMessageType.SEND_TO_USER;\n//   to: UserId;\n//   message: ClientToClientMessage;\n// }\n\nexport type ClientMessage =\n  | ClientMessage__ERROR\n  | ClientMessage__LOGIN\n  | ClientMessage__RECONNECT\n  | ClientMessage__LOGOUT\n  | ClientMessage__USER_ACTIONS;\n// | ClientMessage__SEND_TO_ROOM\n// | ClientMessage__SEND_TO_USER;\n","import { DeadBody } from './../DeadBody';\nimport { SerializedUser } from '../SerializedUser';\nimport { UserId } from '../types';\n\nexport enum ServerMessageType {\n  ERROR = 'ERROR',\n  HANDSHAKE = 'HANDSHAKE',\n  LOGIN_SUCCESS = 'LOGIN_SUCCESS',\n  USER_CONNECTED = 'USER_CONNECTED',\n  USER_DISCONNECTED = 'USER_DISCONNECTED',\n  MESSAGE_FROM_USER = 'MESSAGE_FROM_USER',\n  MESSAGE_TO_ROOM = 'MESSAGE_TO_ROOM',\n  GAME_STEP = 1,\n}\n\ninterface ServerMessage__ERROR {\n  type: ServerMessageType.ERROR;\n  message: string;\n}\n\ninterface ServerMessage__HANDSHAKE {\n  type: ServerMessageType.HANDSHAKE;\n}\n\ninterface ServerMessage__LOGIN_RESULT__SUCCESS {\n  type: ServerMessageType.LOGIN_SUCCESS;\n  users: SerializedUser[];\n}\n\ninterface ServerMessage__USER_CONNECTED {\n  type: ServerMessageType.USER_CONNECTED;\n  user: SerializedUser;\n}\n\ninterface ServerMessage__USER_DISCONNECTED {\n  type: ServerMessageType.USER_DISCONNECTED;\n  uuid: UserId;\n}\n\ninterface ServerMessage__GAME_STEP {\n  type: ServerMessageType.GAME_STEP;\n  users: SerializedUser[];\n  entities: DeadBody[];\n}\n\nexport type ServerMessage =\n  | ServerMessage__ERROR\n  | ServerMessage__HANDSHAKE\n  | ServerMessage__LOGIN_RESULT__SUCCESS\n  | ServerMessage__USER_CONNECTED\n  | ServerMessage__USER_DISCONNECTED\n  | ServerMessage__GAME_STEP;\n","import { DeadBody } from './../../shared/DeadBody';\nimport { Color } from './Color';\nimport { PlayerSprite } from './PlayerSprite';\nimport { User } from './User';\n\nconst canvas = document.querySelector('canvas')!;\nconst context = canvas.getContext('2d')!;\nconst player = new PlayerSprite('assets/sprites/player.png');\nconst phantom = new PlayerSprite('assets/sprites/phantom.png');\nconst body = new PlayerSprite('assets/sprites/body.png');\n\nfullscreen();\nwindow.onresize = fullscreen;\n\nfunction fullscreen() {\n  canvas.width = window.innerWidth;\n  canvas.height = window.innerHeight;\n}\n\nexport function render(users: User[], entities: DeadBody[]) {\n  context.clearRect(0, 0, canvas.width, canvas.height);\n\n  entities.forEach(entity => {\n    const sprite = body.getColor(Color.fromHex(entity.color));\n\n    context.drawImage(\n      sprite,\n      entity.position.x - sprite.width / 2,\n      entity.position.y - sprite.height / 2,\n    );\n  });\n\n  users.forEach(user => {\n    context.fillStyle = user.color.rgb;\n    context.textAlign = 'center';\n\n    context.fillText(\n      user.id,\n      user.position.x,\n      user.position.y - 15 - player.height / 2,\n    );\n\n    if (user.isDead) {\n      const sprite = phantom.getColor(user.color);\n      context.globalAlpha = 0.8;\n\n      context.drawImage(\n        sprite,\n        user.position.x - sprite.width / 2,\n        user.position.y - sprite.height / 2,\n      );\n\n      context.globalAlpha = 1;\n    } else {\n      const sprite = player.getColor(user.color);\n\n      context.drawImage(\n        sprite,\n        user.position.x - sprite.width / 2,\n        user.position.y - sprite.height / 2,\n      );\n    }\n  });\n}\n","import { Color } from './Color';\n\nexport class PlayerSprite {\n  private readonly template = new Image();\n  private readonly colors = new Map<string, HTMLCanvasElement>();\n  isReady = false;\n\n  get width() {\n    return this.template.width;\n  }\n\n  get height() {\n    return this.template.height;\n  }\n\n  constructor(src: string) {\n    this.template.src = src;\n    this.template.onload = () => (this.isReady = true);\n  }\n\n  getColor(color: Color) {\n    if (!this.isReady) {\n      return this.template;\n    }\n\n    const hash = color.rgb;\n\n    if (this.colors.has(hash)) {\n      return this.colors.get(hash)!;\n    }\n\n    const result = this.paintTemplate(color);\n    this.colors.set(hash, result);\n    return result;\n  }\n\n  private paintTemplate(color: Color) {\n    const dark = color.shade(0.5);\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d')!;\n    const { width, height } = this.template;\n\n    canvas.width = width;\n    canvas.height = height;\n    context.drawImage(this.template, 0, 0);\n\n    const image = context.getImageData(0, 0, width, height);\n    const { data } = image;\n\n    for (let i = 0, len = data.length; i < len; i += 4) {\n      const pixel = Color.fromImageData(data, i);\n\n      if (pixel.isReddish) {\n        color.setToImageData(data, i, true);\n      } else if (pixel.isBlueish) {\n        dark.setToImageData(data, i, true);\n      }\n    }\n\n    context.putImageData(image, 0, 0);\n    return canvas;\n  }\n}\n","import { ServerMessageType } from './../../shared/communication/ServerMessage';\nimport { JsonSocket } from '@amatiasq/json-socket';\nimport { ClientMessage } from '../../shared/communication/ClientMessage';\nimport { ServerMessage } from '../../shared/communication/ServerMessage';\n\nexport class Socket extends JsonSocket<ServerMessage, ClientMessage> {\n  readonly listeners;\n\n  constructor(uri: string) {\n    super(uri);\n\n    this.listeners = new Map<ServerMessageType, Listener[]>();\n    this.onMessage(e => this.processMessagePotato(e));\n  }\n\n  onMessageType<T extends ServerMessageType>(\n    type: T,\n    listener: (message: TypedMessage<T>) => void,\n  ) {\n    if (this.listeners.has(type)) {\n      this.listeners.get(type)!.push(listener as any);\n    } else {\n      this.listeners.set(type, [listener as any]);\n    }\n  }\n\n  private processMessagePotato(message: ServerMessage): void {\n    const listeners = this.listeners.get(message.type);\n\n    console.debug(message.type, message);\n\n    if (listeners) {\n      listeners.forEach(x => x(message));\n    } else {\n      console.log(`Unhandled message: ${message.type}`);\n    }\n  }\n}\n\nexport type Listener = (message: ServerMessage) => void;\n\nexport type TypedMessage<T extends ServerMessageType> = Extract<\n  ServerMessage,\n  { type: T }\n>;\n","import { SerializedUser, serializeUser } from '../../shared/SerializedUser';\nimport { Color } from './Color';\n\nexport class User {\n  id;\n  position = { x: 0, y: 0 };\n  color;\n  isDead;\n\n  constructor(\n    { id, position, color, isDead }: SerializedUser,\n    readonly isPlayer = false,\n  ) {\n    this.id = id;\n    this.position = position;\n    this.color = Color.fromHex(color);\n    this.isDead = isDead;\n  }\n\n  toJSON() {\n    return serializeUser({\n      ...this,\n      color: this.color.hex,\n    });\n  }\n}\n","import { Vector } from './Vector';\nimport { UserId } from './types';\n\nexport interface SerializedUser {\n  id: UserId;\n  position: Vector;\n  color: string;\n  isDead: boolean;\n}\n\nexport function serializeUser({ id, position, color, isDead }: SerializedUser) {\n  return { id, position, color, isDead };\n}\n","import { KeyboardActions, KeyCode } from '@amatiasq/keyboard';\n\nimport { Action } from '../../shared/Action';\n\nconst keyboard = new KeyboardActions<Action>();\n\nkeyboard.setDirections(Action.UP, Action.DOWN, Action.LEFT, Action.RIGHT);\nkeyboard.setKeyMap(KeyCode.KeyK, Action.KILL);\n\nexport function watchKeyboard(notify: (actions: Action[]) => void) {\n  keyboard.onChange(actions => notify(actions));\n}\n","export enum Action {\n  UP,\n  DOWN,\n  LEFT,\n  RIGHT,\n  KILL,\n}\n","export function emitterWithChannels<U = string, T = any>() {\n  const channels = new Map<U, Set<(data: T) => void>>();\n  emit.subscribe = subscribe;\n  return emit;\n\n  function emit(channel: U, data: T) {\n    const listeners = channels.get(channel);\n\n    if (listeners) {\n      listeners.forEach(listener => listener(data));\n    }\n  }\n\n  function subscribe(channel: U, listener: (data: T) => void) {\n    const listeners = channels.get(channel) || new Set<(data: T) => void>();\n\n    if (!listener.length) {\n      channels.set(channel, listeners);\n    }\n\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  }\n}\n\nexport type EmitterWithChannels<U = string, T = any> = {\n  (channel: U, data: T): void;\n  subscribe: (channel: U, listener: (data: T) => void) => () => boolean;\n};\n","export function emitter<T = any>() {\n  const listeners = new Set<(data: T) => void>();\n  emit.subscribe = subscribe;\n  return emit;\n\n  function emit(data: T) {\n    listeners.forEach(listener => listener(data));\n  }\n\n  function subscribe(listener: (data: T) => void) {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  }\n}\n\nexport type Emitter<T = any> = {\n  (data: T): void;\n  subscribe: (listener: (data: T) => void) => () => boolean;\n};\n","import { emitter, emitterWithChannels } from '@amatiasq/emitter';\n\nimport { KeyCode } from './KeyCode';\nimport { KeyCodeEvent } from './KeyCodeEvent';\n\ntype Native = (event: KeyboardEvent) => void;\n\nexport class KeyboardController {\n  private readonly pressed = new Set<KeyCode>();\n  private readonly codeToKey = new Map<KeyCode, string>();\n\n  private readonly emitKeyCodeDown = emitterWithChannels<\n    KeyCode,\n    KeyCodeEvent\n  >();\n  private readonly emitKeyCodeUp = emitterWithChannels<KeyCode, KeyCodeEvent>();\n  private readonly emitKeyDown = emitter<KeyCodeEvent>();\n  private readonly emitKeyUp = emitter<KeyCodeEvent>();\n\n  readonly onKeyCodeDown = this.emitKeyCodeDown.subscribe;\n  readonly onKeyCodeUp = this.emitKeyCodeUp.subscribe;\n  readonly onKeyDown = this.emitKeyDown.subscribe;\n  readonly onKeyUp = this.emitKeyUp.subscribe;\n\n  isPaused = false;\n\n  constructor() {\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleKeyUp = this.handleKeyUp.bind(this);\n\n    document.addEventListener('keydown', this.handleKeyDown as Native);\n    document.addEventListener('keyup', this.handleKeyUp as Native);\n  }\n\n  pause() {\n    this.isPaused = true;\n  }\n\n  resume() {\n    this.isPaused = false;\n  }\n\n  isPressed(key: KeyCode) {\n    return this.pressed.has(key);\n  }\n\n  getUserKey(code: KeyCode) {\n    return this.codeToKey.has(code) ? this.codeToKey.get(code) : null;\n  }\n\n  dispose() {\n    document.removeEventListener('keydown', this.handleKeyDown as Native);\n    document.removeEventListener('keyup', this.handleKeyUp as Native);\n  }\n\n  private handleKeyDown(event: KeyCodeEvent) {\n    this.onEvent(event);\n\n    if (this.isPressed(event.code)) {\n      return;\n    }\n\n    this.pressed.add(event.code);\n\n    if (this.isPaused) {\n      return;\n    }\n\n    this.emitKeyDown(event);\n    this.emitKeyCodeDown(event.code, event);\n  }\n\n  private handleKeyUp(event: KeyCodeEvent) {\n    this.onEvent(event);\n\n    if (!this.isPressed(event.code)) {\n      return;\n    }\n\n    this.pressed.delete(event.code);\n\n    if (this.isPaused) {\n      return;\n    }\n\n    this.emitKeyUp(event);\n    this.emitKeyCodeUp(event.code, event);\n  }\n\n  private onEvent(event: KeyCodeEvent) {\n    this.codeToKey.set(event.code, event.key);\n  }\n}\n","export enum KeyCode {\n  // Control\n  AltLeft = 'AltLeft',\n  AltRight = 'AltRight',\n  Backslash = 'Backslash',\n  Backspace = 'Backspace',\n  CapsLock = 'CapsLock',\n  ControlLeft = 'ControlLeft',\n  Enter = 'Enter',\n  Escape = 'Escape',\n  MetaLeft = 'MetaLeft',\n  MetaRight = 'MetaRight',\n  ShiftLeft = 'ShiftLeft',\n  ShiftRight = 'ShiftRight',\n  Tab = 'Tab',\n\n  // Arrows\n  ArrowDown = 'ArrowDown',\n  ArrowLeft = 'ArrowLeft',\n  ArrowRight = 'ArrowRight',\n  ArrowUp = 'ArrowUp',\n\n  // Special chars\n  Backquote = 'Backquote',\n  BracketLeft = 'BracketLeft',\n  BracketRight = 'BracketRight',\n  Comma = 'Comma',\n  Equal = 'Equal',\n  IntlBackslash = 'IntlBackslash',\n  Minus = 'Minus',\n  Period = 'Period',\n  Quote = 'Quote',\n  Semicolon = 'Semicolon',\n  Slash = 'Slash',\n  Space = 'Space',\n\n  // Function\n  F1 = 'F1',\n  F2 = 'F2',\n  F3 = 'F3',\n  F4 = 'F4',\n  F5 = 'F5',\n  F6 = 'F6',\n  F7 = 'F7',\n  F8 = 'F8',\n\n  // Digits\n  Digit0 = 'Digit0',\n  Digit1 = 'Digit1',\n  Digit2 = 'Digit2',\n  Digit3 = 'Digit3',\n  Digit4 = 'Digit4',\n  Digit5 = 'Digit5',\n  Digit6 = 'Digit6',\n  Digit7 = 'Digit7',\n  Digit8 = 'Digit8',\n  Digit9 = 'Digit9',\n\n  // Keys\n  KeyA = 'KeyA',\n  KeyB = 'KeyB',\n  KeyC = 'KeyC',\n  KeyD = 'KeyD',\n  KeyE = 'KeyE',\n  KeyF = 'KeyF',\n  KeyG = 'KeyG',\n  KeyH = 'KeyH',\n  KeyI = 'KeyI',\n  KeyJ = 'KeyJ',\n  KeyK = 'KeyK',\n  KeyL = 'KeyL',\n  KeyM = 'KeyM',\n  KeyN = 'KeyN',\n  KeyO = 'KeyO',\n  KeyP = 'KeyP',\n  KeyQ = 'KeyQ',\n  KeyR = 'KeyR',\n  KeyS = 'KeyS',\n  KeyT = 'KeyT',\n  KeyU = 'KeyU',\n  KeyV = 'KeyV',\n  KeyW = 'KeyW',\n  KeyX = 'KeyX',\n  KeyY = 'KeyY',\n  KeyZ = 'KeyZ',\n}\n","import { emitter, emitterWithChannels } from '@amatiasq/emitter';\n\nimport { KeyboardController } from './KeyboardController';\nimport { KeyCode } from './KeyCode';\nimport { KeyCodeEvent } from './KeyCodeEvent';\n\ntype EnumDeclaration = number | string;\n\nexport class KeyboardActions<T extends EnumDeclaration> {\n  private readonly keyboard = new KeyboardController();\n  private readonly keymap: { [id: string]: T } = {};\n  private readonly actions = new Set<T>();\n  private readonly subscriptions: (() => boolean)[];\n\n  private readonly emitChange = emitter<T[]>();\n  private readonly emitActivate = emitterWithChannels<T, void>();\n  private readonly emitDeactivate = emitterWithChannels<T, void>();\n\n  readonly onChange = this.emitChange.subscribe;\n  readonly onActivate = this.emitActivate.subscribe;\n  readonly onDeactivate = this.emitDeactivate.subscribe;\n\n  get isPaused() {\n    return this.keyboard.isPaused;\n  }\n\n  constructor() {\n    this.subscriptions = [\n      this.keyboard.onKeyDown(this.handleKeyDown),\n      this.keyboard.onKeyUp(this.handleKeyUp),\n    ];\n  }\n\n  // Composition\n\n  pause() {\n    this.keyboard.pause();\n  }\n\n  resume() {\n    this.keyboard.resume();\n  }\n\n  getUserKey(code: KeyCode) {\n    this.keyboard.getUserKey(code);\n  }\n\n  // Features\n\n  setKeyMap(key: KeyCode, action: T) {\n    this.keymap[key] = action;\n  }\n\n  isActive(action: T) {\n    return this.actions.has(action);\n  }\n\n  dispose() {\n    this.subscriptions.forEach(x => x());\n    this.keyboard.dispose();\n  }\n\n  // Helpers\n\n  setDirections(up: T, down: T, left: T, right: T) {\n    this.setArrows(up, down, left, right);\n    this.setWSAD(up, down, left, right);\n  }\n\n  setArrows(up: T, down: T, left: T, right: T) {\n    this.keymap[KeyCode.ArrowUp] = up;\n    this.keymap[KeyCode.ArrowDown] = down;\n    this.keymap[KeyCode.ArrowLeft] = left;\n    this.keymap[KeyCode.ArrowRight] = right;\n  }\n\n  setWSAD(up: T, down: T, left: T, right: T) {\n    this.keymap[KeyCode.KeyW] = up;\n    this.keymap[KeyCode.KeyS] = down;\n    this.keymap[KeyCode.KeyA] = left;\n    this.keymap[KeyCode.KeyD] = right;\n  }\n\n  // Internals\n\n  private getActionFor(code: KeyCode) {\n    if (!KeyCode[code]) {\n      console.log(`Missing key code: ${code}`);\n    }\n\n    return this.keymap[code];\n  }\n\n  private readonly handleKeyDown = this.handle(action => {\n    if (this.actions.has(action)) {\n      return;\n    }\n\n    this.actions.add(action);\n    this.emitActivate(action);\n    this.emitChange(Array.from(this.actions));\n  });\n\n  private readonly handleKeyUp = this.handle(action => {\n    if (!this.actions.has(action)) {\n      return;\n    }\n\n    this.actions.delete(action);\n    this.emitDeactivate(action);\n    this.emitChange(Array.from(this.actions));\n  });\n\n  private handle(operation: (action: T) => void) {\n    return (event: KeyCodeEvent) => {\n      const action = this.getActionFor(event.code);\n\n      if (action != null) {\n        operation(action);\n      }\n    };\n  }\n}\n","export function emitter<T = any>() {\n  const listeners = new Set<(data: T) => void>();\n  subscribe.emit = emit;\n  return subscribe;\n\n  function emit(data: T) {\n    listeners.forEach(listener => listener(data));\n  }\n\n  function subscribe(listener: (data: T) => void) {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\n\nconst DEFAULT_RECONNECTION_DELAY = 100;\nconst MAX_RECONNECT_ATTEMPTS = 14;\n\nexport class JsonSocket<TInput, TOutput> {\n  RECONNECTION_DELAY = DEFAULT_RECONNECTION_DELAY;\n  MAX_RECONNECT_ATTEMPTS = MAX_RECONNECT_ATTEMPTS;\n\n  private reconnectionDelay = DEFAULT_RECONNECTION_DELAY;\n  private reconnectAttempts = 0;\n  private disconnectedAt = new Date();\n  private isReconnecting = false;\n  private isFirstConnection = true;\n\n  private ws = this.init();\n\n  readonly onOpen = emitter<JsonSocket<TInput, TOutput>>();\n  readonly onMessage = emitter<TInput>();\n  readonly onReconnect = emitter<Date>();\n\n  get isConnected() {\n    return !this.isFirstConnection && !this.isReconnecting;\n  }\n\n  constructor(public readonly uri: string) {}\n\n  private init() {\n    const socket = new WebSocket(this.uri);\n\n    socket.onopen = () => this.connectionOpen();\n    socket.onmessage = e => this.processMessage(e);\n    socket.onerror = () => this.connectionLost();\n    socket.onclose = () => this.connectionLost();\n\n    return socket;\n  }\n\n  send(value: TOutput) {\n    this.ws.send(JSON.stringify(value));\n  }\n\n  private processMessage(event: MessageEvent<any>) {\n    let message: TInput;\n\n    try {\n      message = JSON.parse(event.data) as TInput;\n    } catch (error) {\n      console.error('Invalid JSON', event.data);\n      return;\n    }\n\n    this.onMessage.emit(message);\n  }\n\n  private connectionOpen() {\n    this.reconnectionDelay = this.RECONNECTION_DELAY;\n    this.reconnectAttempts = 0;\n    this.isReconnecting = false;\n\n    if (this.isFirstConnection) {\n      this.isFirstConnection = false;\n      this.onOpen.emit(this);\n    } else {\n      this.onReconnect.emit(this.disconnectedAt);\n    }\n  }\n\n  private connectionLost() {\n    if (this.isReconnecting) {\n      return;\n    }\n\n    if (this.reconnectAttempts > this.MAX_RECONNECT_ATTEMPTS) {\n      return console.error(\n        `Websocket aborted after ${this.reconnectAttempts} attempts`,\n      );\n    }\n\n    if (this.reconnectAttempts === 0) {\n      this.isReconnecting = true;\n      this.disconnectedAt = new Date();\n    }\n\n    const message = `Socket closed. Waiting ${this.reconnectionDelay / 1000}s`;\n    const reconnecting = 'Reconnecting...';\n    const singleLine = this.reconnectAttempts < 1000;\n\n    console.debug(`${message} ${singleLine ? reconnecting : ''}`);\n\n    setTimeout(() => {\n      if (!singleLine) {\n        console.debug(reconnecting);\n      }\n\n      this.reconnectionDelay *= 2;\n      this.reconnectAttempts++;\n      this.ws = this.init();\n    }, this.reconnectionDelay);\n  }\n\n  close() {\n    this.ws.onclose = null;\n    this.ws.close();\n  }\n}\n"],"sourceRoot":""}